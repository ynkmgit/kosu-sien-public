{% extends "base.html" %}
{% from 'macros/page_header.html' import page_header %}
{% from 'macros/forms.html' import loading_row, form_card_header, add_button %}
{% block title %}案件管理 - {{ project.name }}{% endblock %}
{% block content %}
{{ page_header(
    title=project.name ~ ' - 案件管理',
    icon='M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4',
    breadcrumbs=[
        {'label': 'プロジェクト一覧', 'href': '/projects'},
        {'label': project.name, 'href': '/projects/' ~ project.id},
        {'label': '案件'}
    ]
) }}

<div class="form-card">
    {{ form_card_header('新規案件追加') }}
    <form class="add-form" hx-post="/projects/{{ project.id }}/issues" hx-target="#issue-table tbody" hx-swap="beforeend" hx-on::after-request="this.reset()">
        <div class="form-group">
            <label class="form-label">CD</label>
            <input type="text" name="cd" placeholder="001" required class="form-input input-cd">
        </div>
        <div class="form-group">
            <label class="form-label">案件名</label>
            <input type="text" name="name" placeholder="案件名を入力" required class="form-input">
        </div>
        <div class="form-group">
            <label class="form-label">ステータス</label>
            <select name="status" class="form-input input-select">
                <option value="open">未着手</option>
                <option value="in_progress">進行中</option>
                <option value="closed">完了</option>
            </select>
        </div>
        <div class="form-group">
            <label class="form-label">説明</label>
            <input type="text" name="description" placeholder="案件の説明" class="form-input">
        </div>
        {{ add_button() }}
    </form>
</div>

<div class="table-card">
    <div class="table-header">
        <span class="table-title">登録済み案件</span>
        <div style="display: flex; align-items: center; gap: 12px;">
            <a href="/projects/{{ project.id }}/assignees" class="btn btn-ghost" style="font-size: 0.85rem;">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                </svg>
                担当割当
            </a>
            <input type="search" name="q" placeholder="検索..." class="search-input"
                   hx-get="/projects/{{ project.id }}/issues/list" hx-trigger="keyup changed delay:300ms"
                   hx-target="#issue-table" hx-swap="innerHTML">
        </div>
    </div>
    <table id="issue-table" hx-get="/projects/{{ project.id }}/issues/list?sort=cd&order=asc" hx-trigger="load" hx-target="#issue-table" hx-swap="innerHTML">
        <thead>
            <tr>
                <th class="col-cd">CD</th>
                <th class="col-name-lg">案件名</th>
                <th class="col-status">ステータス</th>
                <th>説明</th>
                <th class="col-actions">操作</th>
            </tr>
        </thead>
        <tbody>
            {{ loading_row(5) }}
        </tbody>
    </table>
</div>
{% endblock %}
