{% extends "base.html" %}
{% from 'macros/page_header.html' import page_header %}
{% from 'macros/forms.html' import loading_row, form_card_header, add_button %}
{% block title %}見積内訳 - {{ issue.name }}{% endblock %}
{% block content %}
{{ page_header(
    title=issue.name ~ ' - 見積内訳',
    icon='M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z',
    breadcrumbs=[
        {'label': 'プロジェクト一覧', 'href': '/projects'},
        {'label': project.name, 'href': '/projects/' ~ project.id},
        {'label': '案件', 'href': '/projects/' ~ project.id ~ '/issues'},
        {'label': issue.name ~ ' - 見積内訳'}
    ]
) }}

<div class="form-card">
    {{ form_card_header('見積項目追加') }}
    <form class="add-form" hx-post="/projects/{{ project.id }}/issues/{{ issue.id }}/estimates" hx-target="#estimate-table tbody tr.total-row" hx-swap="beforebegin" hx-on::after-request="if(event.detail.successful) { this.reset(); htmx.trigger('#estimate-table', 'refreshTotal'); }">
        <div class="form-group">
            <label class="form-label">項目名</label>
            <input type="text" name="name" placeholder="設計、実装、テスト等" required class="form-input">
        </div>
        <div class="form-group">
            <label class="form-label">工数(h)</label>
            <input type="number" name="hours" placeholder="8.0" required class="form-input input-hours" step="0.25" min="0.25">
        </div>
        {{ add_button() }}
    </form>
</div>

<div class="table-card">
    <div class="table-header">
        <span class="table-title">見積内訳一覧</span>
    </div>
    <table id="estimate-table" hx-get="/projects/{{ project.id }}/issues/{{ issue.id }}/estimates/list" hx-trigger="load, refreshTotal from:body" hx-target="#estimate-table" hx-swap="innerHTML">
        <thead>
            <tr>
                <th class="col-pct-60">項目名</th>
                <th class="col-pct-20">工数(h)</th>
                <th class="col-pct-20">操作</th>
            </tr>
        </thead>
        <tbody>
            {{ loading_row(3) }}
        </tbody>
    </table>
</div>
{% endblock %}
